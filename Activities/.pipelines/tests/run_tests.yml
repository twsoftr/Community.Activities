name: Run Integration Tests $(Date:yyyyMMdd)$(Rev:.r)

variables:
  - group: Secrets
  - name: azureServiceConnectionName
    value: 'AzureDevTest-EA'
  - name: aksResourcePrefix
    value: 'dvts-ts-ta-we'
  - name: sftpContainer
    value: 'sftpserver-deployment'
  - name: sqlserverContainer
    value: 'sqlserver-deployment'
  - name: uipathLicenseCode
    value: $(LicenseCode)
  - name: uipathVersion
    value: '20.10.4'
  - name: studioInstallPath
    value: 'd:\robot'
  - name: orchestratorPSModuleSourceUrl
    value: 'https://www.myget.org/F/uipath-dev/api/v2'
  - name: uipathTestDirectory
    value: 'd:\teste'
  - name: packagesFolder
    value: 'd:\teste\Packages'
  - name: javaBuildPipeline
    value: 1098


# use triggers only on specific branches(no *)
trigger:
  branches:
    include:
      - masters
      - develop
  paths:
    include:
      - Activities/*

# don't user PR triggers 
pr: none

stages:
- stage: Run_Java
  jobs:
  - job: Setup_UiPath_Studio_and_Robot
    pool:
      vmImage: 'windows-latest'
    steps:
    - template: steps/setup_env.yml
      parameters:
        uipathLicenseCode: $(uipathLicenseCode)
        uipathVersion: $(uipathVersion)
        studioInstallPath: $(studioInstallPath)
        orchestratorPSModuleSourceUrl: $(orchestratorPSModuleSourceUrl)
        uipathTestDirectory: $(uipathTestDirectory)

    - template: steps/run_java.yml
      parameters:
        buildPipeline: $(javaBuildPipeline)
        packagesFolder: $(packagesFolder)
        studioInstallPath: $(studioInstallPath)
        uipathTestDirectory: $(uipathTestDirectory)


#   - template: steps/setup_aks.yml
#     parameters:
#       azureServiceConnectionName: $(azureServiceConnectionName)
#       aksResourcePrefix: $(aksResourcePrefix)
#       sftpContainer: $(sftpContainer)
#       sqlserverContainer: $(sqlserverContainer)
#
#   - template: steps/clean_aks.yml
#     parameters:
#       azureServiceConnectionName: $(azureServiceConnectionName)
#       aksResourcePrefix: $(aksResourcePrefix)
#       sftpContainer: $(sftpContainer)
#       sqlserverContainer: $(sqlserverContainer)

#- stage: Run Java
#  jobs:
#  - job: B1
#  - job: B2
#
#- stage: Run Python
#  jobs:
#  - job: A1
#  - job: A2
#
#- stage: Run FTP
#  jobs:
#  - job: B1
#  - job: B2
#
#- stage: Run Database
#  jobs:
#  - job: B1
#  - job: B2

